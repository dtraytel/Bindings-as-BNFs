<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory Ternary_One_Binder_BNF (Isabelle2018: August 2018)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory Ternary_One_Binder_BNF</h1>

<span class="command">theory</span> <span class="name">Ternary_One_Binder_BNF</span><br/>
<span class="keyword">imports</span> <a href="Prelim.html"><span class="name">Prelim</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">theory</span></span><span> </span><span>Ternary_One_Binder_BNF</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>Prelim</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bound(a::&#39;a) &#8801; |UNIV :: &#39;a set|&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">typedecl</span></span><span> </span><span class="delimiter">(</span><span class="tfree">&#39;aa</span><span class="delimiter">,</span><span class="tfree">&#39;a</span><span class="delimiter">,</span><span class="tfree">&#39;c</span><span class="delimiter">)</span><span> </span><span>F</span><span>
</span><span class="keyword1"><span class="command">consts</span></span><span> </span><span>map_F</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;a &#8658; &#39;a) &#8658; (&#39;c &#8658; &#39;c&#39;) &#8658; (&#39;aa &#8658; &#39;aa&#39;) &#8658; 
 (&#39;a,&#39;c,&#39;aa)F &#8658; (&#39;a,&#39;c&#39;,&#39;aa&#39;)F&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">consts</span></span><span> </span><span>set1_F</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;a,&#39;c,&#39;aa)F &#8658; &#39;a set&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">consts</span></span><span> </span><span>set2_F</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;a,&#39;c,&#39;aa)F &#8658; &#39;c set&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">consts</span></span><span> </span><span>set3_F</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;a,&#39;c,&#39;aa)F &#8658; &#39;aa set&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">consts</span></span><span> </span><span>rel_F</span><span> </span><span class="delimiter">::</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;a &#8658; &#39;a) &#8658; (&#39;c &#8658; &#39;c&#39; &#8658; bool) &#8658; (&#39;aa &#8658; &#39;aa&#39; &#8658; bool) &#8658; 
 (&#39;a,&#39;c,&#39;aa)F &#8658; (&#39;a,&#39;c&#39;,&#39;aa&#39;)F &#8658; bool&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">typedecl</span></span><span> </span><span>bd_type_F</span><span>
</span><span class="keyword1"><span class="command">consts</span></span><span> </span><span>bd_F</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bd_type_F rel&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">class</span></span><span> </span><span>var_F</span><span> </span><span class="delimiter">=</span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>var_F</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bd_F &#8804;o bound(any::&#39;a) &#8743; regularCard (bound(any::&#39;a))&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">axiomatization</span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> 
</span><span>  </span><span>F_map_id</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id id id = id&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>F_map_comp1</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896; (u::&#39;a::var_F&#8658;&#39;a) v g f u3 v3.
    bij u &#10233; |supp u| &lt;o bound(any::&#39;a) &#10233; bij v &#10233; |supp v| &lt;o bound(any::&#39;a) &#10233;
    map_F (v o u) (g o f) (v3 o u3)  = map_F v g v3 o map_F u f u3&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>F_set1_map</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896; (u::&#39;a::var_F&#8658;&#39;a) f u3 b.
    bij u &#10233; |supp u| &lt;o bound(any::&#39;a) &#10233;
    set1_F (map_F u f u3 b) = u ` set1_F b&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>F_set2_map</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896; (u::&#39;a::var_F&#8658;&#39;a) f u3 b.
    bij u &#10233; |supp u| &lt;o bound(any::&#39;a) &#10233;
    set2_F (map_F u f u3 b) = f ` set2_F b&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>F_set3_map</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896; (u::&#39;a::var_F&#8658;&#39;a) f u3 b.
    bij u &#10233; |supp u| &lt;o bound(any::&#39;a) &#10233;
    set3_F (map_F u f u3 b) = u3 ` set3_F b&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>F_map_cong</span><span class="delimiter">[</span><span>fundef_cong</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896; (u::&#39;a::var_F&#8658;&#39;a) v f g u3 v3 x.
   bij u &#10233; |supp u| &lt;o bound(any::&#39;a) &#10233; bij v &#10233; |supp v| &lt;o bound(any::&#39;a) &#10233;
   &#8704; a1 &#8712; set1_F x. u a1 = v a1 &#10233;
   &#8704; a2 &#8712; set2_F x. f a2 = g a2 &#10233;
   &#8704; a3 &#8712; set3_F x. u3 a3 = v3 a3 &#10233;
   map_F u f u3 x = map_F v g v3 x&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>bd_F_card_order</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;card_order bd_F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>F_set1_bd</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896;b. |set1_F b| &lt;o bd_F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>F_set2_bd</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896;b. |set2_F b| &lt;o bd_F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>F_set3_bd</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896;b. |set3_F b| &lt;o bd_F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>bd_F_cinfinite</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cinfinite bd_F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>F_rel_id</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F id (=) (=) = (=)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>F_rel_comp_leq</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896; (u::&#39;a::var_F&#8658;&#39;a) v Q R Q3 R3.
   bij u &#10233; |supp u| &lt;o bound(any::&#39;a) &#10233; bij v &#10233; |supp v| &lt;o bound(any::&#39;a) &#10233;
   rel_F u Q Q3 OO rel_F v R R3 &#8804; rel_F (v o u) (Q OO R) (Q3 OO R3)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>  </span><span>F_rel_map_set</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896; (u::&#39;a::var_F&#8658;&#39;a) R R3 x y.
   bij u &#10233; |supp u| &lt;o bound(any::&#39;a) &#10233;
   rel_F u R R3 x y &#10231;
   (&#8707;z. set2_F z &#8838; {(a2, b2). R a2 b2} &#8743; set3_F z &#8838; {(a1, b1). R3 a1 b1} &#8743;  
        map_F id fst fst z = x &#8743; map_F u snd snd z = y)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>bd_F_Card_order</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Card_order bd_F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bd_F_card_order</span><span> </span><span>card_order_on_Card_order</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>var_F</span><span class="delimiter">)</span><span> </span><span>UNIV_cinfinite</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cinfinite (bound(any::&#39;a))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bd_F_cinfinite</span><span> </span><span>cinfinite_mono</span><span> </span><span>local.var_F</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>bound_Card_order</span><span> </span><span class="delimiter">=</span><span> </span><span>card_of_Card_order</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;UNIV::(&#39;a::var_F)set&quot;</span></span></span><span class="delimiter">]</span><span>    
</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>bound_card_order</span><span> </span><span class="delimiter">=</span><span> </span><span>card_of_card_order_on</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;UNIV::(&#39;a::var_F)set&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>bound_regularCard</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;regularCard (bound(any::&#39;a::var_F))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>var_F</span><span class="delimiter">)</span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>bound_cinfinite</span><span> </span><span class="delimiter">=</span><span> </span><span>var_F_class.UNIV_cinfinite</span><span>
</span><span>
</span><span class="keyword1"><span class="command">typedef</span></span><span> </span><span>wit_var_F</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Field (cardSuc bd_F)&quot;</span></span></span><span>  
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Field_cardSuc_not_empty</span><span> </span><span>bd_F_Card_order</span><span> </span><span>ex_in_conv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>wit_var_F_ordIso_bd_F_type_set</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;cardSuc bd_F =o |UNIV:: wit_var_F set|&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|UNIV:: wit_var_F set| =o |Field (cardSuc bd_F)|&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Abs_wit_var_F_inverse</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>card_of_ordIsoI</span><span class="delimiter">[</span><span>of</span><span> </span><span>Rep_wit_var_F</span><span class="delimiter">]</span><span class="delimiter">)</span><span>  </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>Rep_wit_var_F_inject</span><span> </span><span>Rep_wit_var_F</span><span> </span><span>bij_betw_def</span><span> </span><span>inj_on_def</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Card_order_iff_ordIso_card_of</span><span> </span><span>bd_F_Card_order</span><span> 
</span><span>      </span><span>cardSuc_Card_order</span><span> </span><span>ordIso_symmetric</span><span> </span><span>ordIso_transitive</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>bd_F_ordLeq_wit_var_F</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;bd_F &#8804;o |UNIV:: wit_var_F set|&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bd_F &#8804;o cardSuc bd_F&quot;</span></span></span><span>   
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bd_F_Card_order</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>wit_var_F_ordIso_bd_F_type_set</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ordLeq_ordIso_trans</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>regularCard_wit_var_F</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;regularCard |UNIV:: wit_var_F set|&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cinfinite_cardSuc</span><span> </span><span>bd_F_Card_order</span><span> </span><span>bd_F_cinfinite</span><span> </span><span>bd_F_ordLeq_wit_var_F</span><span> 
</span><span>    </span><span>cinfinite_def</span><span> </span><span>cinfinite_mono</span><span> </span><span>infinite_cardSuc_regularCard</span><span> 
</span><span>    </span><span>regularCard_ordIso</span><span> </span><span>wit_var_F_ordIso_bd_F_type_set</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span> 
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*  Need to instantiate the class, else datatype construction will fail: *)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">instantiation</span></span><span> </span><span>wit_var_F</span><span> </span><span class="delimiter">::</span><span> </span><span>var_F</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span class="keyword1"><span class="command">instance</span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>standard</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span class="delimiter">:</span><span> </span><span>regularCard_wit_var_F</span><span> </span><span>bd_F_ordLeq_wit_var_F</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>infinite_Field_bound</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;infinite (Field (bound(any::&#39;a::var_F)))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cinfinite_def</span><span> </span><span>var_F_class.UNIV_cinfinite</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>nonemp_Field_bound</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Field (bound(any::&#39;a::var_F)) &#8800; {}&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>infinite_Field_bound</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>singl_bound</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|{a}| &lt;o bound(any::&#39;a::var_F)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>finite_ordLess_infinite</span><span> </span><span>infinite_Field_bound</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Un_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|A1| &lt;o bound(any::&#39;a::var_F)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|A2| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|A1 &#8746; A2| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span>card_of_Un_ordLess_infinite</span><span> </span><span>infinite_Field_bound</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>UNION_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|I| &lt;o bound(any::&#39;a::var_F)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896;i. i &#8712; I &#10233; |A i| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|&#8899;i&#8712;I. A i| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>assms</span><span> </span><span>bound_Card_order</span><span> </span><span>bound_cinfinite</span><span> </span><span>bound_regularCard</span><span> </span><span>regularCard_UNION</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>imsupp_supp_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;|imsupp g| &lt;o bound(any::&#39;a::var_F) &#10231; |supp g| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Un_bound</span><span> </span><span>card_of_image</span><span> </span><span>imsupp_def</span><span> </span><span>ordLeq_ordLess_trans</span><span> </span><span>supp_ordleq_imsupp</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>emp_bound</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|{}| &lt;o bound(any::&#39;a::var_F)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>card_of_empty4</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>supp_id_bound</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp id| &lt;o bound(any::&#39;a::var_F)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>emp_bound</span><span> </span><span>supp_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>supp_id_upd</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp (id(a := a&#39;))| &lt;o bound(any::&#39;a::var_F)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>supp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;a = a&#39;&quot;</span></span></span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>singl_bound</span><span> </span><span>emp_bound</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>imsupp_id_upd</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|imsupp (id(a := a&#39;))| &lt;o bound(any::&#39;a::var_F)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>imsupp_supp_bound</span><span> </span><span>supp_id_upd</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>supp_inv_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>b</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij f&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp f| &lt;o bound(any::&#39;a::var_F)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp (inv f)| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>supp_inv</span><span class="delimiter">[</span><span>OF</span><span> </span><span>b</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s</span><span> </span><span>card_of_image</span><span> </span><span>ordLeq_ordLess_trans</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>sup_inv_bound_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>b</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij f&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp (inv f)| &lt;o bound(any::&#39;a::var_F) &#10231; |supp f| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>b</span><span> </span><span>bijection.bij_inv</span><span> </span><span>bijection.intro</span><span> </span><span>inv_inv_eq</span><span> </span><span>supp_inv_bound</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>supp_o_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp g| &lt;o bound(any::&#39;a::var_F)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp f| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp (g o f)| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Un_bound</span><span> </span><span>assms</span><span> </span><span>card_of_mono1</span><span> </span><span>ordLeq_ordLess_trans</span><span> </span><span>supp_o</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>supp_inv_o_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp f| &lt;o bound(any::&#39;a::var_F)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp (u &#8728; f &#8728; inv u)| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>assms</span><span> </span><span>supp_inv_bound</span><span> </span><span>supp_o_bound</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>supp_comp_bound</span><span> </span><span class="delimiter">=</span><span> </span><span>supp_o_bound</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>supp_comp2_bound</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a::var_F) &#10233; |supp v| &lt;o bound(any::&#39;a) &#10233; |supp (&#955;a. v (u a))| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_def</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>supp_o_bound</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>finite_less_bound</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;finite A &#10233; |A| &lt;o bound(any::&#39;a::var_F)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bound_cinfinite</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cinfinite_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Field_card_of</span><span> </span><span>card_of_Well_order</span><span> </span><span>finite_ordLess_infinite</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>finite_leq_bound</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;finite A &#10233; |A| &lt;o bound(any::&#39;a::var_F)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>finite_less_bound</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>finite_less_bound</span><span> </span><span>ordLess_imp_ordLeq</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>two_leq_bound</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|{a1,a2}| &lt;o bound(any::&#39;a::var_F)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>finite_less_bound</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>supp_imsupp_bound</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp f| &lt;o bound(any::&#39;a::var_F) &#10233; |imsupp f| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>imsupp_supp_bound</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* SETUP FOR F *)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_rel_comp</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>  </span><span>u</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp (u::&#39;a &#8658; &#39;a)| &lt;o bound(any::&#39;a::var_F)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>v</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;bij v&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp (v::&#39;a &#8658; &#39;a)| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F (v &#8728; u) (Q OO R) ((Q3:: &#39;b3 &#8658; &#39;c3 &#8658; bool) OO (R3:: &#39;c3 &#8658; &#39;d3 &#8658; bool))
    = rel_F u (Q:: &#39;b &#8658; &#39;c &#8658; bool) Q3 OO rel_F v (R :: &#39;c &#8658; &#39;d &#8658; bool) R3&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>order.antisym</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F (v &#8728; u) (Q OO R) (Q3 OO R3) &#8804;  rel_F u Q Q3 OO rel_F v R R3&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> </span><span>y</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>hp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;rel_F (v &#8728; u) (Q OO R) (Q3 OO R3) x y&quot;</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>z</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>z</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;set2_F z &#8838; {(x, y). (Q OO R) x y} &#8743; set3_F z &#8838; {(x, y). (Q3 OO R3) x y} 
        &#8743; map_F (id:: &#39;a &#8658; &#39;a) fst fst z = x &#8743; map_F (v o u) snd snd z = y&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_rel_map_set</span><span> </span><span>bij_comp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>v</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span>supp_o_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>v</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>u</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span>hp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>f10</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>f10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;f10  = (&#955; (x0, y0). (if ((Q3 OO R3) x0 y0) then (SOME w. Q3 x0 w &#8743; R3 w y0)
        else undefined))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>OO_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>f0</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;f0  = (&#955; (x0, y0). (if ((Q OO R) x0 y0) then (SOME w. Q x0 w &#8743; R w y0)
        else undefined))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>OO_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;map_F u snd snd (map_F id (&#955; (x,y). (x, f0 (x,y))) (&#955; (x,y). (x, f10 (x,y))) z)
        = map_F u f0 f10 z&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_apply</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F u snd snd&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>        </span><span>F_map_comp1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span> </span><span>u</span><span class="delimiter">]</span><span> </span><span>o_id</span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_apply</span><span> </span><span>snd_def</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>prod.case_eq_if</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;map_F id fst fst (map_F u (&#955; (x,y). (f0 (x,y), y))(&#955; (x,y). (f10 (x,y), y)) z)
        = map_F u f0 f10 z&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_apply</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id fst fst&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>        </span><span>F_map_comp1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>u</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span> </span><span>id_o</span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_apply</span><span> </span><span>fst_def</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>prod.case_eq_if</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>w</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;map_F u snd snd (map_F id (&#955; (x,y). (x, f0 (x,y))) (&#955; (x,y). (x, f10 (x,y))) z)
             = map_F id fst fst ((map_F u (&#955; (x,y). (f0 (x,y), y )) (&#955; (x,y). (f10 (x,y), y ))) z)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>step1</span><span> </span><span>step2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span class="string"><span class="delete"><span class="delete">&quot;(rel_F u Q Q3 OO rel_F v R R3) x y&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>OO_def</span><span> </span><span>F_rel_map_set</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span>  </span><span>F_rel_map_set</span><span class="delimiter">[</span><span>OF</span><span> </span><span>v</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>intro</span><span> </span><span>exI</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span>
</span><span>          </span><span class="string"><span class="delete"><span class="delete">&quot;map_F u snd snd (map_F id (&#955; (x,y). (x, f0 (x,y))) (&#955; (x,y). (x, f10 (x,y))) z)&quot;</span></span></span><span>
</span><span>          </span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>safe</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;za. 
         set2_F za &#8838; {(x, y). Q x y} &#8743; set3_F za &#8838; {(x, y). Q3 x y} &#8743;
         map_F id fst fst za = x &#8743;
         map_F u snd snd za =
          map_F u snd snd (map_F id (&#955;(ya, y). (ya, f0 (ya, y))) (&#955;(ya, y). (ya, f10 (ya, y))) z)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>intro</span><span> </span><span>exI</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id (&#955; (x,y). (x, f0 (x,y))) (&#955; (x,y). (x, f10 (x,y))) z&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span class="delimiter">,</span><span> </span><span>safe</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>a</span><span> </span><span>b</span><span> 
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(a, b) &#8712; set3_F
            (map_F id (&#955;(za, y). (za, f0 (za, y))) (&#955;(za, y). (za, f10 (za, y))) z) &#10233; Q3 a b&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set3_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>case_prod_beta&#39;</span><span> </span><span>f0</span><span> </span><span>f10</span><span> </span><span>imageE</span><span> </span><span>mem_Collect_eq</span><span>
</span><span>              </span><span>pick_middlep</span><span> </span><span>prod.sel</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>snd_conv</span><span> </span><span>someI_ex</span><span> </span><span>subset_iff</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>a</span><span> </span><span>b</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(a, b) &#8712; set2_F
            (map_F id (&#955;(za, y). (za, f0 (za, y))) (&#955;(za, y). (za, f10 (za, y))) z) &#10233; Q a b&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set2_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>case_prod_beta&#39;</span><span> </span><span>f0</span><span> </span><span>f10</span><span> </span><span>imageE</span><span> </span><span>mem_Collect_eq</span><span>
</span><span>              </span><span>pick_middlep</span><span> </span><span>prod.sel</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>snd_conv</span><span> </span><span>someI_ex</span><span> </span><span>subset_iff</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id fst fst
            (map_F id (&#955;(za, y). (za, f0 (za, y))) (&#955;(za, y). (za, f10 (za, y))) z) = x&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_apply</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id fst fst&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>            </span><span>F_map_comp1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span> </span><span>id_o</span><span>
</span><span>            </span><span>fst_o_is_fst</span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;za. 
         set2_F za &#8838; {(x, y). R x y} &#8743; set3_F za &#8838; {(x, y). R3 x y} &#8743;
         map_F id fst fst za =
          map_F u snd snd (map_F id (&#955;(ya, y). (ya, f0 (ya, y))) (&#955;(ya, y). (ya, f10 (ya, y))) z) &#8743;
         map_F v snd snd za = y&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>intro</span><span> </span><span>exI</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(map_F u (&#955; (x,y). (f0 (x,y), y )) (&#955; (x,y). (f10 (x,y), y ))) z&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span class="delimiter">,</span><span> </span><span>safe</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>a</span><span> </span><span>b</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(a, b) &#8712; set3_F
            (map_F  u (&#955;(za, y). (f0 (za, y), y)) (&#955;(za, y). (f10 (za, y), y)) z) &#10233; R3 a b&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set3_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>case_prod_unfold</span><span> </span><span>f10</span><span> </span><span>f0</span><span> </span><span>fst_conv</span><span> </span><span>imageE</span><span>
</span><span>              </span><span>mem_Collect_eq</span><span> </span><span>pick_middlep</span><span> </span><span>snd_conv</span><span> </span><span>someI_ex</span><span> </span><span>subset_eq</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>a</span><span> </span><span>b</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(a, b) &#8712; set2_F
            (map_F u (&#955;(za, y). (f0 (za, y), y)) (&#955;(za, y). (f10 (za, y), y)) z) &#10233; R a b&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set2_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>case_prod_unfold</span><span> </span><span>f10</span><span> </span><span>f0</span><span> </span><span>fst_conv</span><span> </span><span>imageE</span><span>
</span><span>              </span><span>mem_Collect_eq</span><span> </span><span>pick_middlep</span><span> </span><span>snd_conv</span><span> </span><span>someI_ex</span><span> </span><span>subset_eq</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id fst fst
            (map_F  u (&#955;(za, y). (f0 (za, y), y)) (&#955;(za, y). (f10 (za, y), y)) z) =
            map_F u snd snd (map_F id (&#955;(ya, y). (ya, f0 (ya, y))) (&#955;(ya, y). (ya, f10 (ya, y))) z)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>w</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F v snd snd
            (map_F u (&#955;(za, y). (f0 (za, y), y)) (&#955;(za, y). (f10 (za, y), y)) z) = y&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_apply</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F v snd snd&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>            </span><span>F_map_comp1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>u</span><span> </span><span>v</span><span class="delimiter">]</span><span> </span><span>id_o</span><span> </span><span>snd_o_is_snd</span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>u</span><span> </span><span>v</span><span> </span><span>F_rel_comp_leq</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_rel_mono</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>le</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Q3 &#8804; R3&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Q &#8804; R&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u Q Q3 &#8804; rel_F u R R3&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_map_set</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>le</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_rel_Grp</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u (Grp f) (Grp u3) = Grp (map_F u f u3)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>it</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704; x y. rel_F u (Grp f) (Grp u3) x y = Grp (map_F u f u3) x y&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_map_set</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>safe</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> </span><span>y</span><span> </span><span>z</span><span> 
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>set1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;set3_F (z :: (&#39;a, &#39;b &#215; &#39;d, &#39;c &#215; &#39;e) F) &#8838; {(x, y). Grp u3 x y}&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>set3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;set2_F z &#8838; {(x, y). Grp f x y}&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Grp (map_F u f u3) (map_F (id:: &#39;a &#8658; &#39;a) fst fst z) (map_F u snd snd z)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Grp_def</span><span> </span><span>o_apply</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F u f u3&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>        </span><span>F_map_comp1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span> </span><span>u</span><span class="delimiter">]</span><span> </span><span>o_id</span><span> </span><span>subset_iff</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_map_cong</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>F_map_cong</span><span> </span><span>u</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>u</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> </span><span>y</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>Grpxy</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Grp (map_F u f u3) x y&quot;</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;z. set2_F z &#8838; {(x, y). Grp f x y} &#8743; set3_F z &#8838; {(x, y). Grp u3 x y} &#8743;
             map_F id fst fst z = x &#8743; map_F u snd snd z = y&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>intro</span><span> </span><span>exI</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id (&#955; a. (a, f a)) (&#955; a. (a, u3 a)) x&quot;</span></span></span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>safe</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span>  </span><span>a</span><span> </span><span>b</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>ins1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(a, b) &#8712; set3_F (map_F id (&#955;a. (a, f a)) (&#955;a. (a, u3 a)) x)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Grp u3 a b&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set3_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>GrpI</span><span> </span><span>image_iff</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span>  </span><span>a</span><span> </span><span>b</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>ins3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(a, b) &#8712; set2_F (map_F id (&#955;a. (a, f a)) (&#955;a. (a, u3 a)) x)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Grp f a b&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set2_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>GrpI</span><span> </span><span>image_iff</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id fst fst (map_F id (&#955;a. (a, f a)) (&#955;a. (a, u3 a)) x) = x&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>o_apply</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id fst fst&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>            </span><span>F_map_comp1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span>
</span><span>            </span><span>comp_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>fst</span><span class="delimiter">]</span><span> </span><span>id_def</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span>F_map_id</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F u snd snd (map_F id (&#955;a. (a, f a)) (&#955;a. (a, u3 a)) x) = y&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_apply</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F u snd snd&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span>F_map_comp1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span> </span><span>u</span><span class="delimiter">]</span><span> </span><span>o_id</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Grpxy</span><span> </span><span>GrpE</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>comp_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>it</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_rel_inv_conversep</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F (inv u) (conversep R) (conversep R3) b b&#39; &#10231; rel_F u R R3 b&#39; b&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_map_set</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span> </span><span>F_rel_map_set</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bij_imp_bij_inv</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span>supp_inv_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span class="delimiter">]</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>z_</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;z. set2_F z &#8838; {(x, y). R&#175;&#175; x y} &#8743; set3_F z &#8838; {(x, y). R3&#175;&#175; x y} &#8743; 
    map_F id fst fst z = b &#8743; map_F (inv u) snd  snd z = b&#39;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>z</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>z</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;set2_F z &#8838; {(x, y). R&#175;&#175; x y}&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;set3_F z &#8838; {(x, y). R3&#175;&#175; x y}&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id fst fst z = b&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;map_F (inv u) snd snd z = b&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z_</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;z. set2_F z &#8838; {(x, y). R x y} &#8743; set3_F z &#8838; {(x, y). R3 x y} &#8743; 
    map_F id fst fst z = b&#39; &#8743; map_F u snd snd z = b&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>intro</span><span> </span><span>exI</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F (inv u) (&#955; t. (snd t, fst t)) (&#955; t. (snd t, fst t)) z&quot;</span></span></span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>safe</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>a</span><span> </span><span>b</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(a, b) &#8712; set3_F (map_F (inv u) (&#955;t. (snd t, fst t)) (&#955;t. (snd t, fst t)) z)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;R3 a b&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set3_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bij_imp_bij_inv</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span>supp_inv_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>a</span><span> </span><span>b</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(a, b) &#8712; set2_F (map_F (inv u) (&#955;t. (snd t, fst t)) (&#955;t. (snd t, fst t)) z)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;R a b&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set2_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bij_imp_bij_inv</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span>supp_inv_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id fst fst (map_F (inv u) (&#955;t. (snd t, fst t)) (&#955;t. (snd t, fst t)) z) = b&#39;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_apply</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id fst fst&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>        </span><span>F_map_comp1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>bij_imp_bij_inv</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span>supp_inv_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span>
</span><span>        </span><span>id_o</span><span> </span><span>comp_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>fst</span><span class="delimiter">]</span><span> </span><span>fst_conv</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F u snd snd (map_F (inv u) (&#955;t. (snd t, fst t)) (&#955;t. (snd t, fst t)) z) = b&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_apply</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F u snd snd&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>        </span><span>F_map_comp1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>bij_imp_bij_inv</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span>supp_inv_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span> </span><span>u</span><span class="delimiter">]</span><span>
</span><span>        </span><span>id_o</span><span> </span><span>comp_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>snd</span><span class="delimiter">]</span><span> </span><span>snd_conv</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>u</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>z_</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;z. set2_F z &#8838; {(x, y). R x y} &#8743; 
     set3_F z &#8838; {(x, y). R3 x y} &#8743; map_F id fst fst z = b&#39; &#8743; map_F u snd snd z = b&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>z</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>z</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;set3_F z &#8838; {(x, y). R3 x y}&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;set2_F z &#8838; {(x, y). R x y}&quot;</span></span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id fst fst z = b&#39;&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;map_F u snd snd z = b&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z_</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;z. set2_F z &#8838; {(x, y). R&#175;&#175; x y} &#8743; set3_F z &#8838; {(x, y). R3&#175;&#175; x y} &#8743; 
    map_F id fst fst z = b &#8743; map_F (inv u) snd snd z = b&#39;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>intro</span><span> </span><span>exI</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F u (&#955; t. (snd t, fst t)) (&#955; t. (snd t, fst t)) z&quot;</span></span></span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>safe</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>a</span><span> </span><span>b</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(a, b) &#8712; set3_F (map_F u (&#955;t. (snd t, fst t)) (&#955;t. (snd t, fst t)) z)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;R3 b a&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set3_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>a</span><span> </span><span>b</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(a, b) &#8712; set2_F (map_F u (&#955;t. (snd t, fst t)) (&#955;t. (snd t, fst t)) z)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;R b a&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set2_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id fst fst (map_F u (&#955;t. (snd t, fst t)) (&#955;t. (snd t, fst t)) z) = b&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_apply</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id fst fst&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>        </span><span>F_map_comp1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>u</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span>
</span><span>        </span><span>id_o</span><span> </span><span>comp_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>fst</span><span class="delimiter">]</span><span> </span><span>fst_conv</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F (inv u) snd snd (map_F u (&#955;t. (snd t, fst t)) (&#955;t. (snd t, fst t)) z) = b&#39;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_apply</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F (inv u) snd snd&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>        </span><span>F_map_comp1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>u</span><span> </span><span>bij_imp_bij_inv</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span>supp_inv_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span class="delimiter">]</span><span>
</span><span>        </span><span>id_o</span><span> </span><span>comp_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>snd</span><span class="delimiter">]</span><span> </span><span>snd_conv</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>u</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_rel_conversep</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F (inv u) R&#175;&#175; R3&#175;&#175; = (rel_F u R R3)&#175;&#175;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_rel_inv_conversep</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rel_F_map_F</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u R R3 (map_F id g g3 x) (map_F id h h3 y) =
       rel_F u (&#955;x y. R (g x) (h y)) (&#955;x y. R3 (g3 x) (h3 y)) x y&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#955;x y. R3 (g3 x) (h3 y)) = (Grp g3) OO R3 OO (Grp h3)&#175;&#175;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>BNF_Def.vimage2p_Grp</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span>BNF_Def.vimage2p_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#955;x y. R (g x) (h y)) = (Grp g) OO R OO (Grp h)&#175;&#175;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>BNF_Def.vimage2p_Grp</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span>BNF_Def.vimage2p_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u R R3 (map_F id g g3 x) (map_F id h h3 y) =
    ((Grp (map_F id g g3)) OO (rel_F u R R3) OO (Grp (map_F id h h3))&#175;&#175;) x y&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>BNF_Def.vimage2p_Grp</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span>BNF_Def.vimage2p_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>eq1</span><span> </span><span>eq2</span><span> </span><span>eq3</span><span>
</span><span>      </span><span>F_rel_Grp</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span>
</span><span>      </span><span>F_rel_conversep</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span> </span><span>inv_id</span><span>
</span><span>      </span><span>F_rel_comp</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>assms</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span> </span><span>id_o</span><span>
</span><span>      </span><span>F_rel_comp</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span>o_id</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>map_F_transfer</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;rel_fun (eq_onp (&#955; u::&#39;a::var_F&#8658;&#39;a. bij u &#8743; |supp u| &lt;o bound(any::&#39;a))) 
   (rel_fun (rel_fun (R:: &#39;c &#8658; &#39;e &#8658; bool) (S:: &#39;c&#39; &#8658; &#39;e&#39; &#8658; bool)) 
   (rel_fun (rel_fun (R3:: &#39;b &#8658; &#39;d &#8658; bool) (S3:: &#39;b&#39; &#8658; &#39;d&#39; &#8658; bool))
    (rel_fun (rel_F id R R3 ) (rel_F id S S3)))) 
 map_F map_F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>rel_fun_def</span><span> </span><span>eq_onp_def</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>clarsimp</span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>f3</span><span> </span><span>g3</span><span> </span><span>u</span><span> </span><span>f</span><span> </span><span>g</span><span> </span><span>x</span><span> </span><span>y</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>R3S1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;xa ya. R3 xa ya &#10230; S3 ((f3::&#39;b &#8658; &#39;b&#39;) xa) ((g3:: &#39;d &#8658; &#39;d&#39;) ya)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>u</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;bij (u:: &#39;a &#8658; &#39;a)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>RS</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;x y. R x y &#10230; S ((f:: &#39;c &#8658; &#39;c&#39;) x) ((g:: &#39;e &#8658; &#39;e&#39;) y)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>rel_F</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;rel_F id R R3 (x:: (&#39;a,&#39;c,&#39;b)F) (y:: (&#39;a,&#39;e,&#39;d)F)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>leR3S1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;R3 &#8804; (&#955; x y. S3 (f3 x) (g3 y))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>R3S1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>leRS</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;R &#8804; (&#955; x y. S (f x) (g y))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>RS</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>hp_rel_F</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;rel_F (id::&#39;a &#8658; &#39;a) (&#955; x y. S (f x) (g y)) (&#955; x y. S3 (f3 x) (g3 y)) x y&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_rel_mono</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span> </span><span>leR3S1</span><span> </span><span>leRS</span><span class="delimiter">]</span><span> </span><span>rel_F</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>z0</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>set1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;set3_F z0 &#8838; {(x, y). R3 x y}&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>set3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;set2_F z0 &#8838; {(x, y). R x y}&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>map1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;map_F id fst fst z0 = x&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>map2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;map_F id snd snd z0 = y&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_rel_map_set</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span> </span><span>rel_F</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F id S S3 (map_F (u:: &#39;a &#8658; &#39;a) (f:: &#39;c &#8658; &#39;c&#39;) (f3::&#39;b &#8658; &#39;b&#39;) x)
        (map_F u (g:: &#39;e &#8658; &#39;e&#39;) (g3:: &#39;d &#8658; &#39;d&#39;) y)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_map_set</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>intro</span><span> </span><span>exI</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F u (&#955; (x, y). (f x,  g y)) (&#955; (x, y). (f3 x,  g3 y)) z0&quot;</span></span></span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>safe</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>a</span><span> </span><span>b</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>inset1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(a, b) &#8712; set3_F (map_F u (&#955;(z, y). (f z, g y)) (&#955;(z, y). (f3 z, g3 y)) z0)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eqset1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot; set3_F (map_F u (&#955;(z, y). (f z, g y)) (&#955;(z, y). (f3 z, g3 y)) z0)
        = (&#955;(z, y). (f3 z, g3 y)) ` set3_F z0&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set3_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>inset1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(a, b) &#8712; (&#955;(z, y). (f3 z, g3 y)) ` set3_F z0&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>eqset1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inset1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a0</span><span> </span><span>b0</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>fa</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;f3 a0 = a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>gb</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;g3 b0 = b&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a0b0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(a0,b0) &#8712; set3_F z0&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inset1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;R3 a0 b0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>set1</span><span> </span><span>a0b0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;S3 a b&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step1</span><span> </span><span>R3S1</span><span> </span><span>fa</span><span> </span><span>gb</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>a</span><span> </span><span>b</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>inset3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(a, b) &#8712; set2_F (map_F u (&#955;(z, y). (f z, g y)) (&#955;(z, y). (f3 z, g3 y)) z0)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eqset3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;set2_F (map_F u (&#955;(z, y). (f z, g y)) (&#955;(z, y). (f3 z, g3 y)) z0)
        = (&#955;(z, y). (f z, g y)) ` set2_F z0&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set2_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>inset3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(a, b) &#8712; (&#955;(z, y). (f z, g y)) ` set2_F z0&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>eqset3</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inset3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a0</span><span> </span><span>b0</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>fa</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;f a0 = a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>gb</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;g b0 = b&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a0b0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(a0,b0) &#8712; set2_F z0&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inset3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;R a0 b0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>set3</span><span> </span><span>a0b0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;S a b&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step3</span><span> </span><span>RS</span><span> </span><span>fa</span><span> </span><span>gb</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id fst fst (map_F u (&#955;(z, y). (f z, g y)) (&#955;(z, y). (f3 z, g3 y)) z0)
          = map_F u f f3 x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_apply</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id fst fst&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>        </span><span>F_map_comp1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>u</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span>
</span><span>        </span><span>map1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span>  </span><span>o_apply</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F u f f3&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>        </span><span>F_map_comp1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span> </span><span>u</span><span class="delimiter">]</span><span>
</span><span>        </span><span>id_o</span><span> </span><span>o_id</span><span> </span><span>fst_comp_map_prod</span><span> </span><span>map_prod_def</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id snd snd (map_F u (&#955;(z, y). (f z, g y)) (&#955;(z, y). (f3 z, g3 y)) z0)
      = map_F u g g3 y&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_apply</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id snd snd&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>        </span><span>F_map_comp1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>u</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span>
</span><span>        </span><span>map2</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span>o_apply</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F u g g3&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>        </span><span>F_map_comp1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span> </span><span>u</span><span class="delimiter">]</span><span>
</span><span>        </span><span>id_o</span><span> </span><span>o_id</span><span> </span><span>snd_comp_map_prod</span><span> </span><span>map_prod_def</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rel_F_transfer</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;rel_fun
  (eq_onp (&#955; u::&#39;a::var_F&#8658;&#39;a. bij u &#8743; |supp u| &lt;o bound(any::&#39;a))) 
  (rel_fun
    (rel_fun (R:: &#39;b &#8658; &#39;c &#8658; bool) (rel_fun (S:: &#39;d &#8658; &#39;e &#8658; bool) (=)))
    (rel_fun
    (rel_fun (R3:: &#39;b3 &#8658; &#39;c3 &#8658; bool) (rel_fun (S3:: &#39;d3 &#8658; &#39;e1 &#8658; bool) (=)))
    (rel_fun (rel_F id R R3) (rel_fun (rel_F id S S3) (=))))) rel_F rel_F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>rel_fun_def</span><span> </span><span>eq_onp_def</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>clarsimp</span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>Q3</span><span> </span><span>P3</span><span> </span><span>u</span><span> </span><span>Q</span><span> </span><span>P</span><span> </span><span>x1</span><span> </span><span>x2</span><span> </span><span>y1</span><span> </span><span>y2</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>hp1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;xa ya. R3 xa ya &#10230; (&#8704;xb yb. S3 xb yb &#10230;
      (Q3:: &#39;b3 &#8658; &#39;d3 &#8658; bool) xa xb = (P3:: &#39;c3 &#8658; &#39;e1 &#8658; bool) ya yb)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>u</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp (u::&#39;a &#8658; &#39;a)| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>hp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;x y. R x y &#10230; (&#8704;xa yb. S xa yb &#10230;
      (Q:: &#39;b &#8658; &#39;d &#8658; bool) x xa = (P:: &#39;c &#8658; &#39;e &#8658; bool) y yb)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R3R</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;rel_F (id:: &#39;a &#8658; &#39;a) R R3 x1 x2&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>S1S</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;rel_F (id:: &#39;a &#8658; &#39;a) S S3 y1 y2&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>le11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;R3&#175;&#175; OO Q3 OO S3 &#8804; P3&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>hp1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>le21</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;R3 OO P3 OO S3&#175;&#175; &#8804; Q3&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>hp1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>le1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;R&#175;&#175; OO Q OO S &#8804; P&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>hp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>le2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;R OO P OO S&#175;&#175; &#8804; Q&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>hp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u Q Q3 x1 y1 = rel_F u P P3 x2 y2&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>rQ</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u Q Q3 x1 y1&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((rel_F id R R3)&#175;&#175; OO (rel_F u Q Q3) OO (rel_F id S S3)) x2 y2&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rQ</span><span> </span><span>R3R</span><span> </span><span>S1S</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u (R3&#175;&#175; OO Q3 OO S3) (R&#175;&#175; OO Q OO S) =
      rel_F (id o u o id) (R3&#175;&#175; OO Q3 OO S3) (R&#175;&#175; OO Q OO S)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;rel_F (id o u o id) (R&#175;&#175; OO Q OO S) (R3&#175;&#175; OO Q3 OO S3)
      = (rel_F id R R3)&#175;&#175; OO (rel_F u Q Q3) OO (rel_F id S S3)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_conversep</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>F_rel_comp</span><span> </span><span>u</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>id_comp</span><span> </span><span>inv_id</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u (R&#175;&#175; OO Q OO S) (R3&#175;&#175; OO Q3 OO S3) x2 y2&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step0</span><span> </span><span>step2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u P P3 x2 y2&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_rel_mono</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span> </span><span>le11</span><span> </span><span>le1</span><span class="delimiter">]</span><span> </span><span>step</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>rP</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u P P3 x2 y2&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((rel_F id R R3) OO (rel_F u P P3) OO (rel_F id S S3)&#175;&#175;) x1 y1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rP</span><span> </span><span>R3R</span><span> </span><span>S1S</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u (R OO P OO S&#175;&#175;) (R3 OO P3 OO S3&#175;&#175;)
      = rel_F (id o u o id) (R OO P OO S&#175;&#175;) (R3 OO P3 OO S3&#175;&#175;)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;rel_F (id o u o id) (R OO P OO S&#175;&#175;) (R3 OO P3 OO S3&#175;&#175;)
      = (rel_F id R R3) OO (rel_F u P P3) OO (rel_F id S S3)&#175;&#175;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_conversep</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>F_rel_comp</span><span> </span><span>u</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>id_comp</span><span> </span><span>inv_id</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u (R OO P OO S&#175;&#175;) (R3 OO P3 OO S3&#175;&#175;) x1 y1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step0</span><span> </span><span>step2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u Q Q3 x1 y1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_rel_mono</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span> </span><span>le21</span><span> </span><span>le2</span><span class="delimiter">]</span><span> </span><span>step</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>pred_F</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pred_F &#966;1 &#966;2 &#966;3 b &#8801;
  (&#8704; a1 &#8712; set1_F b. &#966;1 a1) &#8743; (&#8704; a2 &#8712; set2_F b. &#966;2 a2) &#8743; (&#8704; a3 &#8712; set3_F b. &#966;3 a3)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>F_set_map</span><span> </span><span class="delimiter">=</span><span> </span><span>F_set1_map</span><span> </span><span>F_set2_map</span><span> </span><span>F_set3_map</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>F_set_bd</span><span> </span><span class="delimiter">=</span><span> </span><span>F_set1_bd</span><span> </span><span>F_set2_bd</span><span> </span><span>F_set3_bd</span><span>
</span><span>
</span><span class="keyword1"><span class="command">bnf</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;a::var_F,&#39;b,&#39;a3) F&quot;</span></span></span><span>
</span><span>  </span><span>map</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(map_F id) ::  _ &#8658; _ &#8658; (&#39;a::var_F,&#39;b,&#39;a3) F &#8658; _&quot;</span></span></span><span>
</span><span>  </span><span>sets</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;set2_F :: (&#39;a::var_F,&#39;b,&#39;a3) F &#8658; _&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;set3_F :: (&#39;a::var_F,&#39;b,&#39;a3) F &#8658; _&quot;</span></span></span><span> 
</span><span>  </span><span>bd</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bd_F&quot;</span></span></span><span>
</span><span>  </span><span>rel</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(rel_F id) :: _ &#8658; _ &#8658; (&#39;a::var_F,&#39;b,&#39;a3) F &#8658; _ &#8658; _&quot;</span></span></span><span>
</span><span>  </span><span>pred</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(pred_F (&#955;_. True)) :: _ &#8658; _ &#8658; (&#39;a::var_F,&#39;b,&#39;a3) F &#8658; _&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bd_F_cinfinite</span><span> </span><span>bd_F_card_order</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>pred_F_def</span><span> </span><span>F_set3_map</span><span class="delimiter">[</span><span>of</span><span> </span><span>id</span><span class="delimiter">]</span><span> </span><span>F_set2_map</span><span class="delimiter">[</span><span>of</span><span> </span><span>id</span><span class="delimiter">]</span><span>
</span><span>      </span><span>F_rel_comp</span><span class="delimiter">[</span><span>of</span><span> </span><span>id</span><span> </span><span>id</span><span class="delimiter">,</span><span> </span><span>simplified</span><span class="delimiter">]</span><span>
</span><span>      </span><span>F_rel_map_set</span><span class="delimiter">[</span><span>of</span><span> </span><span>id</span><span class="delimiter">,</span><span> </span><span>simplified</span><span class="delimiter">]</span><span>
</span><span>      </span><span>F_map_comp1</span><span class="delimiter">[</span><span>of</span><span> </span><span>id</span><span> </span><span>id</span><span class="delimiter">,</span><span> </span><span>simplified</span><span class="delimiter">]</span><span>
</span><span>      </span><span>fun_eq_iff</span><span> </span><span>F_set3_bd</span><span> </span><span>F_set2_bd</span><span> </span><span>ordLess_imp_ordLeq</span><span> </span><span>F_map_id</span><span> </span><span>emp_bound</span><span> </span><span>supp_id_bound</span><span>
</span><span>      </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>F_map_cong</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rel_F_triv3</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F (&#955;x. x::&#39;a::var_F) (&#955;x y. y = x) (&#955;x y. y = x) b b&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>id_def</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>F.rel_refl_strong</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rel_F_triv2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F id (=) (=) b b&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>F_rel_id</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_set1_transfer</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_fun (rel_F u r r3) (rel_set (Grp u)) set1_F set1_F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>rel_fun_def</span><span> </span><span>rel_set_def</span><span> </span><span>Bex_def</span><span> </span><span>F_rel_map_set</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>safe</span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> </span><span>y</span><span> </span><span>z</span><span> </span><span>a</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;set3_F (z:: (&#39;a, &#39;b &#215; &#39;d, &#39;c &#215; &#39;e) F) &#8838; {(x, y). r3 x y}&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;set2_F z &#8838; {(x, y). r x y}&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;a &#8712; set1_F (map_F id fst fst z)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;x. x &#8712; set1_F (map_F u snd snd z) &#8743; Grp u a x&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>intro</span><span> </span><span>exI</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;u a&quot;</span></span></span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>safe</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;u a &#8712; set1_F (map_F u snd snd z)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set1_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_set1_map</span><span>  
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a</span><span> </span><span>bij_id</span><span> </span><span>f_inv_into_f</span><span> </span><span>id_def</span><span> </span><span>image_eqI</span><span> </span><span>inv_into_into</span><span> </span><span>supp_id_bound</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Grp_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> </span><span>y</span><span> </span><span>z</span><span> </span><span>b</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;set3_F (z:: ( &#39;a,&#39;b &#215; &#39;d,&#39;c &#215; &#39;e) F) &#8838; {(x, y). r3 x y}&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;set2_F z &#8838; {(x, y). r x y}&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>b</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;b &#8712; set1_F (map_F u snd snd z)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>bim</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;b &#8712; u ` set1_F z&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set1_map</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>assms</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>_</span><span> </span><span>snd</span><span> </span><span>snd</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;x. x &#8712; set1_F (map_F id fst fst z) &#8743; Grp u x b&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set1_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span> </span><span>Grp_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bim</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_set2_transfer</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_fun (rel_F u r r3) (rel_set r) set2_F set2_F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>rel_fun_def</span><span> </span><span>rel_set_def</span><span> </span><span>Bex_def</span><span> </span><span>F_rel_map_set</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>safe</span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> </span><span>y</span><span> </span><span>z</span><span> </span><span>x3</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>set1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;set3_F (z:: (&#39;a, &#39;b &#215; &#39;d, &#39;c &#215; &#39;e) F) &#8838; {(x, y). r3 x y}&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>set3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;set2_F z &#8838; {(x, y). r x y}&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(x3:: &#39;b) &#8712; set2_F (map_F id fst fst z)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;x. x &#8712; set2_F (map_F u snd snd z) &#8743; r x3 x&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set2_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_set2_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>fst</span><span> </span><span>fst</span><span class="delimiter">]</span><span> </span><span>x3</span><span> </span><span>set3</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> </span><span>y</span><span> </span><span>z</span><span> </span><span>y3</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>set1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;set3_F (z:: (&#39;a, &#39;b &#215; &#39;d, &#39;c &#215; &#39;e) F) &#8838; {(x, y). r3 x y}&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>set3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;set2_F z &#8838; {(x, y). r x y}&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>y3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(y3:: &#39;d) &#8712; set2_F (map_F u snd snd z)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;x. x &#8712; set2_F (map_F id fst fst z) &#8743; r x y3&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set2_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_set2_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>snd</span><span> </span><span>snd</span><span class="delimiter">]</span><span> </span><span>y3</span><span> </span><span>set3</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_set3_transfer</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_fun (rel_F u r r3) (rel_set r3) set3_F set3_F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>rel_fun_def</span><span> </span><span>rel_set_def</span><span> </span><span>Bex_def</span><span> </span><span>F_rel_map_set</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>safe</span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> </span><span>y</span><span> </span><span>z</span><span> </span><span>x1</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>set1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;set3_F (z:: (&#39;a, &#39;b &#215; &#39;d, &#39;c &#215; &#39;e) F) &#8838; {(x, y). r3 x y}&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>set3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;set2_F z &#8838; {(x, y). r x y}&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(x1:: &#39;c) &#8712; set3_F (map_F id fst fst z)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;x. x &#8712; set3_F (map_F u snd snd z) &#8743; r3 x1 x&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set3_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_set3_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>fst</span><span> </span><span>fst</span><span class="delimiter">]</span><span> </span><span>x1</span><span> </span><span>set1</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> </span><span>y</span><span> </span><span>z</span><span> </span><span>y1</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>set1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;set3_F (z:: (&#39;a, &#39;b &#215; &#39;d, &#39;c &#215; &#39;e) F) &#8838; {(x, y). r3 x y}&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>set3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;set2_F z &#8838; {(x, y). r x y}&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>y1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(y1:: &#39;e) &#8712; set3_F (map_F u snd snd z)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;x. x &#8712; set3_F (map_F id fst fst z) &#8743; r3 x y1&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_set3_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bij_id</span><span> </span><span>supp_id_bound</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_set3_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>snd</span><span> </span><span>snd</span><span class="delimiter">]</span><span> </span><span>y1</span><span> </span><span>set1</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>F_set_transfer</span><span> </span><span class="delimiter">=</span><span> </span><span>F_set3_transfer</span><span> </span><span>F_set1_transfer</span><span> </span><span>F_set2_transfer</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>aux_rel_F_set2_F</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u r r3 b b&#39;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_set r3 (set3_F b) (set3_F b&#39;)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_set3_transfer</span><span class="delimiter">[</span><span>unfolded</span><span> </span><span>rel_fun_def</span><span class="delimiter">,</span><span> </span><span>rule_format</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>aux_rel_F_set3_F</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u r r3 b b&#39;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;set1_F b&#39; = u ` set1_F b&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_set1_transfer</span><span class="delimiter">[</span><span>unfolded</span><span> </span><span>rel_fun_def</span><span> </span><span>rel_set_def</span><span class="delimiter">,</span><span> </span><span>rule_format</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>Grp_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>aux_rel_F_set1_F</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u r r3 b b&#39;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_set r (set2_F b) (set2_F b&#39;)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_set2_transfer</span><span class="delimiter">[</span><span>unfolded</span><span> </span><span>rel_fun_def</span><span class="delimiter">,</span><span> </span><span>rule_format</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_rel_set2_bij_betw</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>bb&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u R R3 b b&#39;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij_betw u (set1_F b) (set1_F b&#39;)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>bij_betw_def</span><span> </span><span>inj_on_def</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_set_transfer</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">[</span><span>unfolded</span><span> </span><span>rel_fun_def</span><span> </span><span>rel_set_def</span><span class="delimiter">,</span><span> </span><span>rule_format</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>u</span><span> </span><span>bb&#39;</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span>assms</span><span class="delimiter">[</span><span>unfolded</span><span> </span><span>bij_betw_def</span><span> </span><span>inj_on_def</span><span class="delimiter">]</span><span> </span><span>F_set1_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>aux_rel_F_set3_F</span><span> </span><span>image_eqI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>aux_rel_F_set3_F</span><span> </span><span>u</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_rel_mono_strong0</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>v</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>v</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij v&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp v| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>relQ</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u Q Q3 b b&#39;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>set1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;a1&#8712;set1_F b. u a1 = v a1&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>set2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;a2&#8712;set2_F b. &#8704;a2&#39;&#8712;set2_F b&#39;. Q a2 a2&#39; &#10230; R a2 a2&#39;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>set3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;a3&#8712;set3_F b. &#8704;a3&#39;&#8712;set3_F b&#39;. Q3 a3 a3&#39; &#10230; R3 a3 a3&#39;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F v R R3 b b&#39;&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>z</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>    </span><span>z</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;set2_F z &#8838; {(x, y). Q x y}&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;set3_F z &#8838; {(x, y). Q3 x y}&quot;</span></span></span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;map_F id fst fst z = b&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F u snd snd z = b&#39;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_rel_map_set</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span class="delimiter">]</span><span> </span><span>relQ</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>*</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;set1_F z = set1_F b&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>z</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span>F_set1_map</span><span> </span><span>supp_id_bound</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_map_set</span><span class="delimiter">[</span><span>OF</span><span> </span><span>v</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>intro</span><span> </span><span>exI</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span>z</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>safe</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>a</span><span> </span><span>a&#39;</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>F_set_map</span><span> </span><span>u</span><span> </span><span>image_def</span><span> </span><span>supp_id_bound</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>exI</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span>z</span><span class="delimiter">]</span><span> </span><span>set2</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>a</span><span> </span><span>a&#39;</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>F_set_map</span><span> </span><span>u</span><span> </span><span>image_def</span><span> </span><span>supp_id_bound</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>exI</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span>z</span><span class="delimiter">]</span><span> </span><span>set3</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>z</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>*</span><span> </span><span>z</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span>assms</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span>  </span><span>F_map_cong</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_rel_mono_strong1</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u Q Q3 b b&#39;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;a2&#8712;set2_F b. &#8704;a2&#39;&#8712;set2_F b&#39;. Q a2 a2&#39; &#10230; R a2 a2&#39;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;a3&#8712;set3_F b. &#8704;a3&#39;&#8712;set3_F b&#39;. Q3 a3 a3&#39; &#10230; R3 a3 a3&#39;&quot;</span></span></span><span>    
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u R R3 b b&#39;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_rel_mono_strong0</span><span class="delimiter">[</span><span>of</span><span> </span><span>u</span><span> </span><span>u</span><span class="delimiter">]</span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_rel_map_left</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a1::var_F&#8658;&#39;a1&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>v</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a1::var_F&#8658;&#39;a1&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a1)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>v</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij v&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp v| &lt;o bound(any::&#39;a1)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>R3</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;b3 &#8658; &#39;c3 &#8658; bool&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;b2 &#8658; &#39;c2 &#8658; bool&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>v3</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a3 &#8658; &#39;b3&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>f</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a2 &#8658; &#39;b2&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u R R3 (map_F v f v3 b) b&#39; =
       rel_F (&#955;x. u (v x)) (&#955;x y. R (f x) y) (&#955;x y. R3 (v3 x) y) b b&#39;&quot;</span></span></span><span>
</span><span>    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?L = ?R&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="var">?L</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>L</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F v (Grp f) (Grp v3) b (map_F v f v3 b)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_rel_Grp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>v</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>f</span><span> </span><span>v3</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Grp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?R</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_rel_comp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>v</span><span> </span><span>u</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Grp f&quot;</span></span></span><span> </span><span>R</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Grp v3&quot;</span></span></span><span> </span><span>R3</span><span> </span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>L</span><span> </span><span>0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_def</span><span> </span><span>OO_def</span><span> </span><span>Grp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="var">?R</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>R</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F (u &#8728; v) (Grp f OO R) (Grp v3 OO R3) b b&#39;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_def</span><span> </span><span>Grp_def</span><span> </span><span>OO_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?L</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_comp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>v</span><span> </span><span>u</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Grp f&quot;</span></span></span><span> </span><span>R</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Grp v3&quot;</span></span></span><span> </span><span>R3</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>OO_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_Grp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>v</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Grp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*does the following still make sense, now that we have bijections?*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_rel_map_right</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a1::var_F&#8658;&#39;a1&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>v</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a1&#8658;&#39;a1&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a1)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>v</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij v&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp v| &lt;o bound(any::&#39;a1)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>R3</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;c3 &#8658; &#39;a3 &#8658; bool&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;c2 &#8658; &#39;a2 &#8658; bool&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>v3</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a3 &#8658; &#39;b3&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>f</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a2 &#8658; &#39;b2&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u R R3 b b&#39;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F (v o u) (R OO Grp f) (R3 OO Grp v3) b (map_F v f v3 b&#39;)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F v (Grp f) (Grp v3) b&#39; (map_F v f v3 b&#39;)&quot;</span></span></span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_rel_Grp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_Grp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>v</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Grp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_comp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span> </span><span>v</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r</span><span> </span><span>0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_rel_map_right_bij</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a1::var_F&#8658;&#39;a1&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>v</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a1::var_F&#8658;&#39;a1&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a1)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>v</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij v&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp v| &lt;o bound(any::&#39;a1)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>R3</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a3 &#8658; &#39;b3 &#8658; bool&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a2 &#8658; &#39;b2 &#8658; bool&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>v3</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;c3 &#8658; &#39;b3&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>f</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;c2 &#8658; &#39;b2&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u R R3 b (map_F v f v3 b&#39;) =
       rel_F  (inv v o u) (&#955;x y. R x (f y)) (&#955;x y. R3 x (v3 y)) b b&#39;&quot;</span></span></span><span>
</span><span>    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?L = ?R&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="var">?L</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>L</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>00</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F v (Grp f) (Grp v3) b&#39; (map_F v f v3 b&#39;)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_Grp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>v</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Grp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F (inv v) (conversep (Grp f)) (conversep (Grp v3)) (map_F v f v3 b&#39;) b&#39;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>00</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_inv_conversep</span><span class="delimiter">[</span><span>OF</span><span> </span><span>v</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Grp f&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Grp v3&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?R</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_rel_comp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span>
</span><span>        </span><span>bij_imp_bij_inv</span><span class="delimiter">[</span><span>OF</span><span> </span><span>v</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span>supp_inv_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>v</span><span class="delimiter">]</span><span class="delimiter">,</span><span> 
</span><span>        </span><span>of</span><span> </span><span>R</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;conversep (Grp f)&quot;</span></span></span><span> </span><span>R3</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;conversep (Grp v3)&quot;</span></span></span><span> </span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>L</span><span> </span><span>0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_def</span><span> </span><span>OO_def</span><span> </span><span>Grp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="var">?R</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>R</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F (inv v &#8728; u) (R OO conversep (Grp f)) (R3 OO conversep (Grp v3)) b b&#39;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_def</span><span> </span><span>Grp_def</span><span> </span><span>OO_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?L</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_comp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>u</span><span>
</span><span>        </span><span>bij_imp_bij_inv</span><span class="delimiter">[</span><span>OF</span><span> </span><span>v</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span>supp_inv_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>v</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>R</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;conversep (Grp f)&quot;</span></span></span><span> </span><span>R3</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;conversep (Grp v3)&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>OO_def</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_inv_conversep</span><span class="delimiter">[</span><span>OF</span><span> </span><span>v</span><span> </span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_Grp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>v</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Grp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>F_rel_map</span><span> </span><span class="delimiter">=</span><span> </span><span>F_rel_map_left</span><span> </span><span>F_rel_map_right</span><span> </span><span>F_rel_map_right_bij</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>aux_map_F</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;b&#39; = map_F u f u3 b &#10231; rel_F u (&#955; tt tt&#39;. tt&#39; = f tt) (&#955; a a&#39;. a&#39; = u3 a) b b&#39;&quot;</span></span></span><span>
</span><span>    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?L &#10231; ?R&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?L &#10231; rel_F u (Grp f) (Grp u3) b b&#39;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_Grp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Grp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;... = ?R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span>  </span><span>Grp_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>F.rel_mono_strong</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_map_comp</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>v</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>v</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij v&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp v| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F (v o u) (f o g) (v3 o u3) p = map_F v f v3 (map_F u g u3 p)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_map_comp1</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_map_cong_id</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896; a. a &#8712; set1_F p &#10233; u a = a&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896; a. a &#8712; set2_F p &#10233; f a = a&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896; a. a &#8712; set3_F p &#10233; u3 a = a&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F u f u3 p = p&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F u f u3 p = map_F id id id p&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>F_map_cong</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>supp_id_bound</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>F_map_id</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_bij_map</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u3&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>f</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij f&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij (map_F u f u3)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F u f u3 o map_F (inv u) (inv f) (inv u3) = id&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;map_F (inv u) (inv f) (inv u3) o map_F u f u3 = id&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>F_map_comp1</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span>F_map_id</span><span> </span><span>sup_inv_bound_iff</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>o_bij</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_inj_map</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u3&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>f</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij f&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;inj (map_F u f u3)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_bij_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>bij_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>inj1_map_F</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u3&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>f</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij f&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map_F u f u3 b1 = map_F u f u3 b2 &#10231; b1 = b2&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_inj_map</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>inj_on_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>F_rel_compp</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>u</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>v</span><span class="delimiter">::</span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a::var_F&#8658;&#39;a&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>u</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij u&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp u| &lt;o bound(any::&#39;a)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>v</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij v&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp v| &lt;o bound(any::&#39;a)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F v R R3 x y&quot;</span></span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F u S S3 y z&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rel_F (u o v) (R OO S) (R3 OO S3) x z&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F_rel_comp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>v</span><span> </span><span>u</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>R</span><span> </span><span>S</span><span> </span><span>R3</span><span> </span><span>S3</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*   *)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>asBijSS</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;a &#8658; &#39;a) &#8658; &#39;a &#8658; &#39;a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;asBijSS f &#8801; if bij f &#8743; |supp f| &lt;o bound(any::&#39;a) then f else id&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>bij_imp_asBij</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;bij (f::&#39;a::var_F&#8658;&#39;a) &#10233; |supp f| &lt;o bound(any::&#39;a) &#10233; asBijSS f = f&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>asBijSS_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>bij_asBijSS</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bij (asBijSS (f::&#39;a::var_F&#8658;&#39;a))&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>asBijSS_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>supp_asBijSS</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;|supp (asBijSS (f::&#39;a::var_F&#8658;&#39;a))| &lt;o bound(any::&#39;a)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>asBijSS_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>supp_id_bound</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>asBijSS_id</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;asBijSS (id::&#39;a::var_F&#8658;&#39;a) = id&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>asBijSS_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span></pre>

</div>
</body>
</html>
